server:
  port: 8082

spring:
  application:
    name: core-api-service

  # Конфигурация для загрузки файлов
  servlet:
    multipart:
      enabled: true
      max-file-size: 50MB
      max-request-size: 50MB
      file-size-threshold: 2KB

  datasource:
    url: jdbc:postgresql://localhost:5432/postgres
    username: postgres
    password: 9911
    driver-class-name: org.postgresql.Driver
    hikari:
      connection-timeout: 20000
      maximum-pool-size: 20
      minimum-idle: 10
      idle-timeout: 300000
      max-lifetime: 1200000
      leak-detection-threshold: 60000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        # Оптимизации для решения N+1 проблемы
        default_batch_fetch_size: 16
        jdbc.batch_size: 20
        order_inserts: true
        order_updates: true
        jdbc.batch_versioned_data: true
        # Статистика отключена (ранее была true). Включайте временно через профиль или вручную при необходимости.
        generate_statistics: false
        # Отключаем кеширование второго уровня пока что
        cache.use_second_level_cache: false
        cache.use_query_cache: false

  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      batch-size: 16384
      linger-ms: 5
    consumer:
      group-id: core-api-service-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"

# Конфигурация хранения файлов
file:
  upload:
    dir: ./uploads
    max-size: 52428800  # 50MB в байтах
    allowed-types: image/jpeg,image/png,image/gif,image/webp,image/bmp,image/tiff,image/svg+xml,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/csv,text/html,text/xml,application/json,application/xml,application/zip,application/x-zip-compressed,application/x-rar-compressed,application/x-7z-compressed,application/gzip,application/x-tar,video/mp4,video/avi,video/quicktime,video/x-msvideo,audio/mpeg,audio/wav,audio/ogg,audio/mp3,application/octet-stream

# JWT Configuration
jwt:
  secret: SYDLF52DangerKeySYDLF9911894325962389476582937465986348957632897562387ww7sfusdfy9374hguif738794fgu9iw3g4f987uswuhfiuGIUDS9GDUSWHTPIWEHYS0DFS098DF98SDFSHDFUSH9374FISDU87SADASUDGHGHAISD7A9OSD823UGHRUIHGSDW9D78Y238RUIOSWADHFOUWHSSDFDDUHWWF9384FGSD

logging:
  level:
    com.messenger.core: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    # Был DEBUG, понижен до WARN чтобы скрыть Session Metrics
    org.hibernate.stat: WARN
    # Подавляем подробный вывод конфигурации Kafka (ConsumerConfig печатает при INFO)
    org.apache.kafka: WARN
    org.apache.kafka.clients.consumer.ConsumerConfig: ERROR
